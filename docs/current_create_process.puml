@startuml
allowmixing

actor "Library User" as user

class "TestProcessWrapper" as wrapper {
  - Dictionary<string, string> _arguments
  - Dictionary<string, string> _environmentVariables
  - ITestProcessBuilderFactory _testProcessBuilderFactory
  - ITestProcess _process
  + BuildConfiguration BuildConfiguration
  + bool IsCoverletEnabled

  + AddCommandLineArgument(...)
  + AddEnvironmentVariable(...)
  + Start()
}

user -- wrapper : interact\nonly with >

interface "ITestProcessBuilderFactory" as factory_if << factory >> {
  + CreateBuilder(isCoverletEnabled, buildConfiguration)
}

class "TestProcessBuilderFactory" as factory << factory >>
factory_if <|-- factory

factory_if -* wrapper : _testProcessBuilderFactory

abstract class "TestProcessBuilder" as new_builder {
  + constructor(appProjectName)
  + AddCommandLineArguments(...)
  + AddEnvironmentVariables(...)
  + Build()
}

class "UnwrappedProcessBuilder" as builder
new_builder <|-- builder
factory --> builder : create >

wrapper *-- builder : _testProcessBuilder

class "CoverletWrappedProcessBuilder" as coverlet_builder
new_builder <|--- coverlet_builder

interface "ITestProcess" as process_if {
  + Start()
}

wrapper *- process_if : _process

class "TestProcess" as process
process_if <|-- process

new_builder -> process : create >

note bottom of builder
if (!_isCoverletEnabled)
{
    processStartInfo = CreateProcessStartInfo("dotnet", _testProjectInfo.AppDllName);
}
else
{
    processStartInfo = CreateProcessStartInfoWithCoverletWrapper();
}
end note
@enduml